name: CI/CD â€“ Portafolio Personal (Docker)

on:
  push:
    branches: [ main ]
  workflow_dispatch:    # disparo manual opcional

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: production

    steps:
      # ---------- SSH ----------
      - name: ðŸ”‘ Agregar clave SSH
        uses: webfactory/ssh-agent@v0.9.0
        with:
          ssh-private-key: ${{ secrets.PROD_SSH_KEY }}

      # ---------- Ejecutar script remoto ----------
      - name: ï¿½ Ejecutar script de despliegue en VPS
        run: |
          ssh -o StrictHostKeyChecking=no ${{ secrets.PROD_USER }}@${{ secrets.PROD_HOST }} << 'EOF'
            cd /var/www/portafolio
            # Ejecutamos el script pasando un Enter (o una 'n') para que las preguntas (como la de los seeders) no traben el script
            echo "n" | bash deploy.sh
          EOF
